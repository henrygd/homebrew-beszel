# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class BeszelAgent < Formula
  desc "Agent for Beszel, a lightweight server monitoring platform."
  homepage "https://beszel.dev"
  version "0.12.6"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/henrygd/beszel/releases/download/v0.12.6/beszel-agent_darwin_amd64.tar.gz"
      sha256 "0b69d2f5657ac2dbee3b2c9a4201cb0d60b4bf54e7a08077cc09f2536eab6b88"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/henrygd/beszel/releases/download/v0.12.6/beszel-agent_darwin_arm64.tar.gz"
      sha256 "4ecfaeac5bd83afcbe845999f676e922ffa5e42cd680ac03a4ef06b7d953e8c5"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel? and Hardware::CPU.is_64_bit?
      url "https://github.com/henrygd/beszel/releases/download/v0.12.6/beszel-agent_linux_amd64.tar.gz"
      sha256 "da613e2e7cb0481a8093562faa636c0b4baa94822fcfbdfa901e849629bea8b4"
      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
    if Hardware::CPU.arm? and !Hardware::CPU.is_64_bit?
      url "https://github.com/henrygd/beszel/releases/download/v0.12.6/beszel-agent_linux_arm.tar.gz"
      sha256 "b4ad500c5c022b9a464ade8e2d6d8d319e2b35b37a32bd183ad692b96d4f9073"
      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
    if Hardware::CPU.arm? and Hardware::CPU.is_64_bit?
      url "https://github.com/henrygd/beszel/releases/download/v0.12.6/beszel-agent_linux_arm64.tar.gz"
      sha256 "b2f74f6f48f6225aa6e0d082ae70d33fff8c82ee2c0ac118215264292a9db0f9"
      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
  end

  service do
    run ["#{bin}/beszel-agent-launcher"]
    log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    error_log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    keep_alive true
    restart_delay 5
    process_type :background
  end
end
