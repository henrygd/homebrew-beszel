# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class BeszelAgent < Formula
  desc "Agent for Beszel, a lightweight server monitoring platform."
  homepage "https://beszel.dev"
  version "0.11.0"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/henrygd/beszel/releases/download/v0.11.0/beszel-agent_darwin_amd64.tar.gz"
      sha256 "a8d1a4ec936ddec14f2e1ff00c13b06f33022b4c4710a74eff1d33a07abf5d20"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/henrygd/beszel/releases/download/v0.11.0/beszel-agent_darwin_arm64.tar.gz"
      sha256 "e6c395c30cc09ed3954897954518aebde170ac2ccb98c537b0b7a74c0a3dbdb6"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel?
      if Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.0/beszel-agent_linux_amd64.tar.gz"
        sha256 "02a713a4c2f7ba9a4e314cf7fe736ea4c69d99f7eb52690bf0c2918be0a716b2"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
    if Hardware::CPU.arm?
      if !Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.0/beszel-agent_linux_arm.tar.gz"
        sha256 "1d8b0bc1a2df589dc76a3ffc489beee3b3d48553b2610b9bb7379e73150abcc3"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
    if Hardware::CPU.arm?
      if Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.0/beszel-agent_linux_arm64.tar.gz"
        sha256 "1c2f34ba4ca9f143b16deb45dd23f69bd03f569d88af0150e41f622fc93fb065"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
  end

  service do
    run ["#{bin}/beszel-agent-launcher"]
    log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    error_log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    keep_alive true
  end
end
