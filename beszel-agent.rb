# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class BeszelAgent < Formula
  desc "Agent for Beszel, a lightweight server monitoring platform."
  homepage "https://beszel.dev"
  version "0.11.1"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/henrygd/beszel/releases/download/v0.11.1/beszel-agent_darwin_amd64.tar.gz"
      sha256 "d4aff6949721f64566b25d908e87a19aaae5f67b3be3d5098f3364c7a1e917fd"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/henrygd/beszel/releases/download/v0.11.1/beszel-agent_darwin_arm64.tar.gz"
      sha256 "74b910235b561e9ebcc3f9e0cddafb4d355e96ceb65643cec6761ca65b7df04e"

      def install
        bin.install "beszel-agent"
        (bin/"beszel-agent-launcher").write <<~EOS
          #!/bin/bash
          set -a
          if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
            source "$HOME/.config/beszel/beszel-agent.env"
          fi
          set +a
          exec #{bin}/beszel-agent "$@"
        EOS
        (bin/"beszel-agent-launcher").chmod 0755
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel?
      if Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.1/beszel-agent_linux_amd64.tar.gz"
        sha256 "b9b2cae9def36d19b4e280821b0eba25a15f05d9e7d73d7e90a49c595002315f"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
    if Hardware::CPU.arm?
      if !Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.1/beszel-agent_linux_arm.tar.gz"
        sha256 "1c96352f80194cddc054d29f51b49c0773e57834d4387407bb5490f5d5b2844e"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
    if Hardware::CPU.arm?
      if Hardware::CPU.is_64_bit?
        url "https://github.com/henrygd/beszel/releases/download/v0.11.1/beszel-agent_linux_arm64.tar.gz"
        sha256 "6d98267117dc1bc3c5da44d088b721365c2d041fdae7f35e89b14498be979a92"

        def install
          bin.install "beszel-agent"
          (bin/"beszel-agent-launcher").write <<~EOS
            #!/bin/bash
            set -a
            if [ -f "$HOME/.config/beszel/beszel-agent.env" ]; then
              source "$HOME/.config/beszel/beszel-agent.env"
            fi
            set +a
            exec #{bin}/beszel-agent "$@"
          EOS
          (bin/"beszel-agent-launcher").chmod 0755
        end
      end
    end
  end

  service do
    run ["#{bin}/beszel-agent-launcher"]
    log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    error_log_path "#{Dir.home}/.cache/beszel/beszel-agent.log"
    keep_alive true
  end
end
